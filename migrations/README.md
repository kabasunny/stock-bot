# データベースマイグレーション

このディレクトリには、[`golang-migrate/migrate`](https://github.com/golang-migrate/migrate) ツールを使用してデータベーススキーマを管理するためのSQLファイルが含まれています。

## 目的

アプリケーションがデータベーススキーマを自動的に変更する (例: `gorm.AutoMigrate` など) のではなく、バージョン管理され、明示的なこのアプローチを使用してスキーマの変更を管理します。これにより、特に本番環境において、より優れた制御、安全性、予測可能性がもたらされます。

## ファイル命名規則

各マイグレーションは2つのファイルで構成されます。

-   `[バージョン]_[名前].up.sql`: マイグレーションを適用するためのSQLコマンド (例: `CREATE TABLE`, `ALTER TABLE`) を含みます。
-   `[バージョン]_[名前].down.sql`: マイグレーションを元に戻すためのSQLコマンド (例: `DROP TABLE`, `ALTER TABLE`) を含みます。

`[バージョン]` は、ツールによって自動的に生成される一意の連番のタイムスタンプです。

## ワークフロー

### 1. 新しいマイグレーションの作成

スキーマ変更 (例: テーブルやカラムの追加) が必要な場合は、プロジェクトのルートから以下のコマンドを使用して新しいマイグレーションファイルセットを作成します。

```sh
migrate create -ext sql -dir migrations <migration_name>
```

`<migration_name>` を、変更内容を表す短く分かりやすい名前に置き換えてください (例: `add_user_email_column`)。

### 2. マイグレーションの適用

データベースに保留中のマイグレーションを適用するには、プロジェクトルートのメイン `README.md` に記載されている手順を参照してください。
