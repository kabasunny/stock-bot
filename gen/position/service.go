// Code generated by goa v3.23.1, DO NOT EDIT.
//
// position service
//
// Command:
// $ goa gen stock-bot/design

package position

import (
	"context"
	positionviews "stock-bot/gen/position/views"
)

// The position service provides information about current holdings.
type Service interface {
	// List current positions.
	List(context.Context, *ListPayload) (res *StockbotPositionCollection, err error)
}

// APIName is the name of the API as defined in the design.
const APIName = "stockbot"

// APIVersion is the version of the API as defined in the design.
const APIVersion = "0.0.1"

// ServiceName is the name of the service as defined in the design. This is the
// same value that is set in the endpoint request contexts under the ServiceKey
// key.
const ServiceName = "position"

// MethodNames lists the service method names as defined in the design. These
// are the same values that are set in the endpoint request contexts under the
// MethodKey key.
var MethodNames = [1]string{"list"}

// ListPayload is the payload type of the position service list method.
type ListPayload struct {
	// 取得するポジション種別 (all, cash, margin)
	Type string
}

// A single trading position.
type PositionResult struct {
	// 銘柄コード
	Symbol string
	// ポジション種別 (CASH, MARGIN_LONG, MARGIN_SHORT)
	PositionType string
	// 保有数量
	Quantity float64
	// 平均取得単価
	AverageCost float64
	// 現在値
	CurrentPrice *float64
	// 評価損益
	UnrealizedPl *float64
	// 評価損益率(%)
	UnrealizedPlRate *float64
	// 建日 (信用取引の場合 YYYYMMDD)
	OpenedDate *string
}

// StockbotPositionCollection is the result type of the position service list
// method.
type StockbotPositionCollection struct {
	// 保有ポジションのリスト
	Positions []*PositionResult
}

// NewStockbotPositionCollection initializes result type
// StockbotPositionCollection from viewed result type
// StockbotPositionCollection.
func NewStockbotPositionCollection(vres *positionviews.StockbotPositionCollection) *StockbotPositionCollection {
	return newStockbotPositionCollection(vres.Projected)
}

// NewViewedStockbotPositionCollection initializes viewed result type
// StockbotPositionCollection from result type StockbotPositionCollection using
// the given view.
func NewViewedStockbotPositionCollection(res *StockbotPositionCollection, view string) *positionviews.StockbotPositionCollection {
	p := newStockbotPositionCollectionView(res)
	return &positionviews.StockbotPositionCollection{Projected: p, View: "default"}
}

// newStockbotPositionCollection converts projected type
// StockbotPositionCollection to service type StockbotPositionCollection.
func newStockbotPositionCollection(vres *positionviews.StockbotPositionCollectionView) *StockbotPositionCollection {
	res := &StockbotPositionCollection{}
	if vres.Positions != nil {
		res.Positions = make([]*PositionResult, len(vres.Positions))
		for i, val := range vres.Positions {
			if val == nil {
				res.Positions[i] = nil
				continue
			}
			res.Positions[i] = transformPositionviewsPositionResultViewToPositionResult(val)
		}
	}
	return res
}

// newStockbotPositionCollectionView projects result type
// StockbotPositionCollection to projected type StockbotPositionCollectionView
// using the "default" view.
func newStockbotPositionCollectionView(res *StockbotPositionCollection) *positionviews.StockbotPositionCollectionView {
	vres := &positionviews.StockbotPositionCollectionView{}
	if res.Positions != nil {
		vres.Positions = make([]*positionviews.PositionResultView, len(res.Positions))
		for i, val := range res.Positions {
			if val == nil {
				vres.Positions[i] = nil
				continue
			}
			vres.Positions[i] = transformPositionResultToPositionviewsPositionResultView(val)
		}
	} else {
		vres.Positions = []*positionviews.PositionResultView{}
	}
	return vres
}

// transformPositionviewsPositionResultViewToPositionResult builds a value of
// type *PositionResult from a value of type *positionviews.PositionResultView.
func transformPositionviewsPositionResultViewToPositionResult(v *positionviews.PositionResultView) *PositionResult {
	if v == nil {
		return nil
	}
	res := &PositionResult{
		Symbol:           *v.Symbol,
		PositionType:     *v.PositionType,
		Quantity:         *v.Quantity,
		AverageCost:      *v.AverageCost,
		CurrentPrice:     v.CurrentPrice,
		UnrealizedPl:     v.UnrealizedPl,
		UnrealizedPlRate: v.UnrealizedPlRate,
		OpenedDate:       v.OpenedDate,
	}

	return res
}

// transformPositionResultToPositionviewsPositionResultView builds a value of
// type *positionviews.PositionResultView from a value of type *PositionResult.
func transformPositionResultToPositionviewsPositionResultView(v *PositionResult) *positionviews.PositionResultView {
	res := &positionviews.PositionResultView{
		Symbol:           &v.Symbol,
		PositionType:     &v.PositionType,
		Quantity:         &v.Quantity,
		AverageCost:      &v.AverageCost,
		CurrentPrice:     v.CurrentPrice,
		UnrealizedPl:     v.UnrealizedPl,
		UnrealizedPlRate: v.UnrealizedPlRate,
		OpenedDate:       v.OpenedDate,
	}

	return res
}
