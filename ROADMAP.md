# Goa プロキシサービス移行ロードマップ

---
**このロードマップについて**

このファイルは、既存のGoプロジェクトをGoaフレームワークを用いたプロキシマイクロサービスに移行するための作業計画と進捗を管理するものです。

**活用方法:**
- **セッションの開始時:** 作業を始める前にこのファイルを確認し、現在の進捗と次のタスクを把握します。
- **タスクの実行:** 各ステップに記載された具体的なコマンドやコード編集を行います。
- **進捗の更新:** 1つのタスクが完了するたびに、チェックボックスを `- [ ]` から `- [x]` に更新します。

これにより、複数日にわたる作業でも、一貫性を保ちながらスムーズに開発を再開することを目指します。
---

## フェーズ 1: 残高照会 API の実装 (Balance Service)

- [x] **ステップ 1: プロジェクトのセットアップ**
  - [x] 1-1. `design` ディレクトリを作成する (`mkdir design`)
  - [x] 1-2. `go.mod` にGoaの依存関係を追加する (`go get goa.design/goa/v3/cmd/goa@v3`)
  - [x] 1-3. `go mod tidy` を実行して依存関係を整理する

- [ ] **ステップ 2: APIデザインの作成**
  - [ ] 2-1. `design/design.go` ファイルを新規作成する
  - [ ] 2-2. `design.go` に `API`, `Service`, `Method` の基本構造を記述する
  - [ ] 2-3. `summary` メソッドのレスポンスとして返す型(Result Type)を定義する (例: `BalanceSummary`)
  - [ ] 2-4. `Balance` サービスに `summary` メソッドを定義し、レスポンスとして `BalanceSummary` を指定する

- [ ] **ステップ 3: コード生成と確認**
  - [ ] 3-1. `goa gen` を実行してサーバーコードのひな形を生成する
  - [ ] 3-2. `gen/http/balance/server/types.go` が生成され、`BalanceSummary` に対応する型が定義されているか確認する
  - [ ] 3-3. `gen/balance/service.go` が生成され、`Service` インターフェースが定義されているか確認する

- [ ] **ステップ 4: ビジネスロジックの実装**
  - [ ] 4-1. `internal/app/balance_service.go` を新規作成する
  - [ ] 4-2. `balance.Service` インターフェースを実装する構造体 (`balanceService`) を定義する
  - [ ] 4-3. `summary` メソッドを実装する。この中で、既存の `BalanceUsecase` を呼び出し、結果を `gen` で生成されたレスポンス型に詰め替える

- [ ] **ステップ 5: サーバーエントリーポイントの構築**
  - [ ] 5-1. `cmd/myapp/main.go` の内容をGoaサーバーを起動するコードに書き換える
  - [ ] 5-2. `main.go` 内で、`balance_service.go` で作成したサービス実装をインスタンス化する
  - [ ] 5-3. Goaが生成したエンドポイントにサービス実装をマウント（登録）する
  - [ ] 5-4. HTTPサーバーを起動する

- [ ] **ステップ 6: 動作確認**
  - [ ] 6-1. `go run ./cmd/myapp` でサーバーを起動する
  - [ ] 6-2. ブラウザでOpenAPIドキュメント (`/swagger/swagger.json`) にアクセスできるか確認する
  - [ ] 6-3. `curl` や他のツールを使い、`summary` エンドポイントにリクエストを送り、正しいレスポンスが返ってくるか確認する

## フェーズ 2: 注文 API の実装 (Order Service)
*(フェーズ1完了後に詳細化)*

## フェーズ 3: その他機能の API 化
*(フェーズ2完了後に詳細化)*

---
## ブランチ戦略 (Branching Strategy)

このプロジェクトでは、以下のフィーチャーブランチ戦略を採用します。

1.  **機能単位でブランチを作成:**
    各フェーズ（例: Balance Serviceの実装）ごとに、`feature/`プレフィックスを付けたブランチを1つ作成します。
    (例: `feature/implement-balance-service`)

2.  **コミットによる進捗記録:**
    作成したフィーチャーブランチ上で、ロードマップの各ステップの作業を行います。キリの良い単位でコミットし、変更内容を記録します。

3.  **フェーズ完了後にマージ:**
    1つのフェーズ（機能実装）が完了し、動作確認が取れたら、そのフィーチャーブランチをメインブランチにマージします。
